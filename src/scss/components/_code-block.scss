@use "sass:map";

$code-block-prefix: "code-block" !default;

$code-block-radii: (
    "sm": 0.25rem,
    // 4px
    "md": 0.5rem,
    // 8px
    "lg": 0.75rem, // 12px
) !default;

$code-block-font-sizes: (
    "sm": 0.8125rem,
    // 13px
    "md": 0.875rem,
    // 14px
    "lg": 1rem, // 16px
) !default;

@keyframes code-block-glow {
    from {
        box-shadow: 0 0 8px -2px var(--code-block-accent-color);
    }
    to {
        box-shadow: 0 0 16px -2px var(--code-block-accent-color);
    }
}

.#{$code-block-prefix} {
    --code-block-bg: #1e1e1e;
    --code-block-fg: #d4d4d4;
    --code-block-radius: #{map.get($code-block-radii, "md")};
    --code-block-font-size: #{map.get($code-block-font-sizes, "md")};
    --code-block-font-family:
        "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
    --code-block-padding: 1.25rem;
    --code-block-header-bg: #333333;
    --code-block-border-color: #444444;
    --code-block-line-number-color: #858585;
    --code-block-line-highlight-bg: rgba(255, 255, 255, 0.05);
    --code-block-accent-color: #007acc; // A generic accent color

    position: relative;
    background-color: var(--code-block-bg);
    color: var(--code-block-fg);
    border-radius: var(--code-block-radius);
    font-family: var(--code-block-font-family);
    font-size: var(--code-block-font-size);

    &__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem var(--code-block-padding);
        background-color: var(--code-block-header-bg);
        border-bottom: 1px solid var(--code-block-border-color);
        font-size: 0.875em;
        border-top-left-radius: inherit;
        border-top-right-radius: inherit;
    }

    &__content {
        margin: 0;
        padding: var(--code-block-padding);
        overflow: auto;
        code {
            display: block;
            white-space: pre;
            background: none;
            font-family: inherit;
            color: inherit;
        }
    }

    &__copy-button {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        padding: 0.5rem;
        background-color: var(--code-block-header-bg);
        border: 1px solid var(--code-block-border-color);
        border-radius: #{map.get($code-block-radii, "sm")};
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s ease;
        .icon-copy {
            display: block;
        }
        .icon-check {
            display: none;
        }
        &.is-copied {
            .icon-copy {
                display: none;
            }
            .icon-check {
                display: block;
            }
        }
        &:hover {
            opacity: 1;
        }
    }
}

@each $name, $radius in $code-block-radii {
    .#{$code-block-prefix}--radius-#{$name} {
        --code-block-radius: #{$radius};
    }
}
@each $name, $size in $code-block-font-sizes {
    .#{$code-block-prefix}--font-#{$name} {
        --code-block-font-size: #{$size};
    }
}

.#{$code-block-prefix}--with-line-numbers {
    .#{$code-block-prefix}__content {
        counter-reset: line;
        padding-left: 0;
    }
    .#{$code-block-prefix}__line {
        display: block;
        padding-left: calc(var(--code-block-padding) + 2.5em);
        position: relative;
        &::before {
            counter-increment: line;
            content: counter(line);
            position: absolute;
            left: var(--code-block-padding);
            width: 2em;
            text-align: right;
            color: var(--code-block-line-number-color);
            user-select: none;
        }
    }
}
.#{$code-block-prefix}__line--highlighted {
    background-color: var(--code-block-line-highlight-bg);
    display: block;
    margin: 0 calc(-1 * var(--code-block-padding));
    padding-left: var(--code-block-padding);
    padding-right: var(--code-block-padding);
}
.#{$code-block-prefix}--with-line-numbers
    .#{$code-block-prefix}__line--highlighted {
    margin: 0;
    padding-left: calc(var(--code-block-padding) + 2.5em);
    background-origin: content-box;
}
.#{$code-block-prefix}--light-theme {
    --code-block-bg: #f8f9fa;
    --code-block-fg: #212529;
    --code-block-header-bg: #e9ecef;
    --code-block-border-color: #dee2e6;
    --code-block-line-number-color: #adb5bd;
    --code-block-line-highlight-bg: rgba(0, 0, 0, 0.05);
}
.#{$code-block-prefix}--bordered {
    border: 1px solid var(--code-block-border-color);
}
.#{$code-block-prefix}--no-header {
    .#{$code-block-prefix}__header {
        display: none;
    }
    .#{$code-block-prefix}__copy-button {
        top: 0.5rem;
        right: 0.5rem;
        background-color: var(--code-block-bg);
    }
}
.#{$code-block-prefix}--command-line
    .#{$code-block-prefix}__line:not(.is-output)::before {
    content: "$";
    position: absolute;
    left: var(--code-block-padding);
    color: var(--code-block-line-number-color);
    user-select: none;
}

// --- Aesthetic & Theming Variants (10) ---
.#{$code-block-prefix}--theme-solarized {
    --code-block-bg: #fdf6e3;
    --code-block-fg: #657b83;
    --code-block-header-bg: #eee8d5;
    --code-block-border-color: #eee8d5;
    --code-block-line-number-color: #93a1a1;
    --code-block-line-highlight-bg: #eee8d5;
}
.#{$code-block-prefix}--theme-monokai {
    --code-block-bg: #272822;
    --code-block-fg: #f8f8f2;
    --code-block-header-bg: #3e3d32;
    --code-block-border-color: #555448;
    --code-block-line-number-color: #898882;
    --code-block-line-highlight-bg: #49483e;
}
.#{$code-block-prefix}--mac-os-window .#{$code-block-prefix}__header::before {
    content: "";
    display: block;
    position: absolute;
    left: var(--code-block-padding);
    top: 0.85rem;
    width: 54px;
    height: 12px;
    background-image: url("data:image/svg+xml,%3Csvg width='54' height='12' viewBox='0 0 54 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='6' cy='6' r='6' fill='%23FF5F56'/%3E%3Ccircle cx='27' cy='6' r='6' fill='%23FFBD2E'/%3E%3Ccircle cx='48' cy='6' r='6' fill='%2327C93F'/%3E%3C/svg%3E%0A");
}
.#{$code-block-prefix}--frosted-glass {
    background-color: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(12px);
}
.#{$code-block-prefix}--glowing {
    animation: code-block-glow 1.5s ease-in-out infinite alternate;
}
.#{$code-block-prefix}--accent-border-top {
    border-top: 4px solid var(--code-block-accent-color);
}
.#{$code-block-prefix}--no-background {
    --code-block-bg: transparent;
    --code-block-header-bg: transparent;
}
.#{$code-block-prefix}--custom-scrollbar
    .#{$code-block-prefix}__content::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}
.#{$code-block-prefix}__content::-webkit-scrollbar-track {
    background: var(--code-block-header-bg);
}
.#{$code-block-prefix}__content::-webkit-scrollbar-thumb {
    background: var(--code-block-line-number-color);
    border-radius: 4px;
}
.#{$code-block-prefix}--floating {
    box-shadow:
        0 10px 25px -5px rgba(0, 0, 0, 0.2),
        0 8px 10px -6px rgba(0, 0, 0, 0.2);
}
.#{$code-block-prefix}--subtle-pattern {
    background-image:
        linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
        linear-gradient(
            to right,
            rgba(255, 255, 255, 0.02) 1px,
            transparent 1px
        );
    background-size: 20px 20px;
}

// --- Structural & Layout Variants (8) ---
.#{$code-block-prefix}--density-compact {
    --code-block-padding: 0.75rem;
    font-size: 0.9em;
}
.#{$code-block-prefix}--density-spacious {
    --code-block-padding: 2rem;
}
.#{$code-block-prefix}--expandable {
    /* JS Hook: Add `.is-expanded` class to show all content */
    max-height: 200px;
    position: relative;
    .#{$code-block-prefix}__content {
        overflow: hidden;
    }
    &.is-expanded {
        max-height: none;
    }
}
.#{$code-block-prefix}--with-tabs {
    /* Requires HTML structure for tabs */
    .#{$code-block-prefix}__header {
        padding: 0;
    }
    .code-block__tab {
        padding: 0.75rem 1.25rem;
        cursor: pointer;
        opacity: 0.7;
        &.is-active {
            opacity: 1;
            background-color: var(--code-block-bg);
        }
    }
}
.#{$code-block-prefix}--with-footer {
    .#{$code-block-prefix}__footer {
        padding: 0.75rem var(--code-block-padding);
        border-top: 1px solid var(--code-block-border-color);
        font-size: 0.875em;
        color: var(--code-block-line-number-color);
    }
}
.#{$code-block-prefix}--split-view {
    display: grid;
    grid-template-columns: 1fr 1fr;
    .#{$code-block-prefix}__preview {
        border-left: 1px solid var(--code-block-border-color);
        padding: var(--code-block-padding);
    }
}
.#{$code-block-prefix}--full-bleed {
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    border-radius: 0;
}
.#{$code-block-prefix}--hide-copy-button .#{$code-block-prefix}__copy-button {
    display: none;
}

// --- Line & Content Variants (8) ---
.#{$code-block-prefix}--with-diff {
    .#{$code-block-prefix}__line--added {
        background-color: rgba(46, 160, 67, 0.15);
        &::before {
            content: "+";
            color: #2ea043;
        }
    }
    .#{$code-block-prefix}__line--removed {
        background-color: rgba(248, 81, 73, 0.15);
        &::before {
            content: "-";
            color: #f85149;
        }
    }
}
.#{$code-block-prefix}--focus-mode
    .#{$code-block-prefix}__line:not(
        .#{$code-block-prefix}__line--highlighted
    ) {
    opacity: 0.4;
    transition: opacity 0.3s;
}
.#{$code-block-prefix}--word-wrap .#{$code-block-prefix}__content code {
    white-space: pre-wrap;
    word-break: break-all;
}
.#{$code-block-prefix}--line-hover-highlight
    .#{$code-block-prefix}__line:hover {
    background-color: var(--code-block-line-highlight-bg);
}
.#{$code-block-prefix}__line--error {
    background-color: rgba(248, 81, 73, 0.15);
}
.#{$code-block-prefix}__line--warning {
    background-color: rgba(234, 179, 8, 0.15);
}
.#{$code-block-prefix}--clickable-lines .#{$code-block-prefix}__line {
    cursor: pointer;
}
.#{$code-block-prefix}--with-language-badge::after {
    content: attr(data-language);
    position: absolute;
    top: 0;
    right: 0;
    padding: 0.25rem 0.6rem;
    background: var(--code-block-header-bg);
    color: var(--code-block-line-number-color);
    font-size: 0.75em;
    border-bottom-left-radius: var(--code-block-radius);
}

// --- Behavioral & JS Hook Variants (4) ---
.#{$code-block-prefix}--copy-on-click {
    cursor: copy;
}
.#{$code-block-prefix}--editable .#{$code-block-prefix}__content code {
    outline: none;
} /* JS hook for contenteditable="true" */
.#{$code-block-prefix}--no-scrollbars
    .#{$code-block-prefix}__content::-webkit-scrollbar {
    display: none;
}
.#{$code-block-prefix}__content {
    -ms-overflow-style: none;
    scrollbar-width: none;
}
/* JS Hook: Add a tooltip element inside the copy button */
.#{$code-block-prefix}__copy-button .code-block__tooltip {
    position: absolute; /* Styles for a tooltip */
}
