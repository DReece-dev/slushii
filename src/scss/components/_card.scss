@use "sass:map";
@use "sass:math"; // IMPORT THE MATH MODULE TO USE math.div()

$card-prefix: "card" !default;

// Maps for generating composable utility classes.
$card-shadows: (
    "sm": "0 1px 2px 0 rgba(0, 0, 0, 0.05)",
    "md": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)",
    "lg":
        "0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1)",
    "none": "none",
) !default;

$card-radii: (
    "sm": 0.25rem,
    // 4px
    "md": 0.5rem,
    // 8px
    "lg": 1rem, // 16px
) !default;

$card-paddings: (
    "sm": 1rem,
    "md": 1.5rem,
    "lg": 2rem,
) !default;

.#{$card-prefix} {
    // CSS variables for complete control over the card's appearance.
    --card-bg: var(--white, #ffffff);
    --card-fg: var(--gray-800, #1f2937);
    --card-radius: #{map.get($card-radii, "md")};
    --card-shadow: #{map.get($card-shadows, "md")};
    --card-border-color: var(--gray-200, #e5e7eb);
    --card-header-padding: 1rem #{map.get($card-paddings, "md")};
    --card-content-padding: #{map.get($card-paddings, "md")};
    --card-footer-padding: 1rem #{map.get($card-paddings, "md")};

    display: flex;
    flex-direction: column;
    position: relative;
    background-color: var(--card-bg);
    color: var(--card-fg);
    border-radius: var(--card-radius);
    box-shadow: var(--card-shadow);
    border: 1px solid transparent; // Placeholder for bordered variant
    overflow: hidden; // KEY IMPROVEMENT: This clips children (images, etc.) automatically.
    transition:
        box-shadow 0.2s ease,
        transform 0.2s ease;

    // BEM: Image Element
    &__image {
        display: block;
        width: 100%;
        // No radius needed here, the parent card's overflow clips it.
    }

    // BEM: Header Element
    &__header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--card-header-padding);
        border-bottom: 1px solid var(--card-border-color);
    }

    // BEM: Content Element
    &__content {
        padding: var(--card-content-padding);
        flex-grow: 1; // Allows content to fill available space
    }

    // BEM: Title & Description Elements
    &__title {
        font-size: 1.25em;
        font-weight: 600;
        margin: 0;
    }
    &__description {
        font-size: 1em;
        color: var(--gray-600, #4b5563);
        margin-top: 0.25em;
    }

    // BEM: Footer Element
    &__footer {
        display: flex;
        justify-content: flex-end; // Common default for action buttons
        align-items: center;
        gap: 0.75rem;
        padding: var(--card-footer-padding);
        border-top: 1px solid var(--card-border-color);
    }
}

// Generate shadow variants
@each $name, $shadow in $card-shadows {
    .#{$card-prefix}--shadow-#{$name} {
        --card-shadow: #{$shadow};
    }
}

// Generate border-radius variants
@each $name, $radius in $card-radii {
    .#{$card-prefix}--radius-#{$name} {
        --card-radius: #{$radius};
    }
}

// Generate padding variants
@each $name, $padding in $card-paddings {
    .#{$card-prefix}--padding-#{$name} {
        --card-content-padding: #{$padding};
        // CORRECTED: Use math.div() for division
        --card-header-padding: #{math.div($padding, 1.5)} #{$padding};
        --card-footer-padding: #{math.div($padding, 1.5)} #{$padding};
    }
}

// Style Modifier: Bordered (replaces shadow with a border)
.#{$card-prefix}--bordered {
    --card-shadow: #{map.get($card-shadows, "none")};
    border-color: var(--card-border-color);
}

// Style Modifier: Interactive (for hover effects)
.#{$card-prefix}--interactive {
    cursor: pointer;
    &:hover {
        transform: translateY(-4px);
        --card-shadow: #{map.get($card-shadows, "lg")};
    }
}

// Style Modifier: Flush (removes content padding)
.#{$card-prefix}--flush {
    --card-content-padding: 0;
}
