@use "sass:map";

$prefix: "tooltip" !default;

// A map to hold all default CSS variables for easy setup and theming.
$config: (
    // Sizing & Spacing
    "padding-y": 0.375rem,
    "padding-x": 0.75rem,
    "font-size": 0.875rem,
    "radius": 0.5rem,
    "arrow-size": 6px,
    "offset": 10px,

    // Distance between tooltip and trigger element
    // Theming
    "bg": #1f2d37,
    // gray-800
    "fg": #f9fafb,
    // gray-50
    // FIXED: Wrapped multi-part shadow value in parentheses
    "shadow": (
            0 4px 6px -1px rgba(0, 0, 0, 0.1),
            0 2px 4px -2px rgba(0, 0, 0, 0.1)
        ),
    // Animation
    "transition-duration": "0.15s",
    "z-index": 90
) !default;

// The trigger element that the tooltip is attached to.
// We use a class for better scoping and to avoid attribute selector performance hits.
.#{$prefix}-trigger {
    position: relative;
    display: inline-block; // Or inline-flex, etc.
}

// The main tooltip element (the "block")
.#{$prefix} {
    // Generate CSS custom properties from the $config map
    @each $key, $value in $config {
        --tooltip-#{$key}: #{$value};
    }

    // --- Core Styles ---
    position: absolute;
    z-index: var(--tooltip-z-index);
    padding: var(--tooltip-padding-y) var(--tooltip-padding-x);
    width: max-content; // Automatically size to content
    max-width: 280px; // Prevent overly wide tooltips
    font-size: var(--tooltip-font-size);
    font-weight: 500;
    color: var(--tooltip-fg);
    background-color: var(--tooltip-bg);
    border-radius: var(--tooltip-radius);
    box-shadow: var(--tooltip-shadow);
    text-align: center;
    line-height: 1.5;
    pointer-events: none; // Tooltip itself isn't interactive

    // --- Visibility & Animation ---
    opacity: 0;
    transform: scale(0.95);
    transition:
        opacity var(--tooltip-transition-duration) ease-out,
        transform var(--tooltip-transition-duration) ease-out;

    // The arrow element
    &__arrow {
        position: absolute;
        width: calc(var(--tooltip-arrow-size) * 2);
        height: calc(var(--tooltip-arrow-size) * 2);
        background-color: var(--tooltip-bg);
        transform: rotate(45deg);
    }
}

// --- Show/Hide Logic ---
// Use a class or `[aria-describedby]` to show the tooltip
.#{$prefix}-trigger:hover .#{$prefix},
.#{$prefix}-trigger:focus-visible .#{$prefix} {
    opacity: 1;
    transform: scale(1);
}

// --- Placement Variants ---

// Top (Default)
.#{$prefix}--top {
    bottom: calc(100% + var(--tooltip-offset));
    left: 50%;
    transform-origin: bottom center;
    transform: translateX(-50%) scale(0.95);

    .#{$prefix}__arrow {
        bottom: calc(var(--tooltip-arrow-size) * -1); // Position arrow outside
        left: calc(50% - var(--tooltip-arrow-size));
    }
}
.#{$prefix}-trigger:hover .#{$prefix}--top,
.#{$prefix}-trigger:focus-visible .#{$prefix}--top {
    transform: translateX(-50%) scale(1);
}

// Bottom
.#{$prefix}--bottom {
    top: calc(100% + var(--tooltip-offset));
    left: 50%;
    transform-origin: top center;
    transform: translateX(-50%) scale(0.95);

    .#{$prefix}__arrow {
        top: calc(var(--tooltip-arrow-size) * -1);
        left: calc(50% - var(--tooltip-arrow-size));
    }
}
.#{$prefix}-trigger:hover .#{$prefix}--bottom,
.#{$prefix}-trigger:focus-visible .#{$prefix}--bottom {
    transform: translateX(-50%) scale(1);
}

// Right
.#{$prefix}--right {
    top: 50%;
    left: calc(100% + var(--tooltip-offset));
    transform-origin: left center;
    transform: translateY(-50%) scale(0.95);

    .#{$prefix}__arrow {
        top: calc(50% - var(--tooltip-arrow-size));
        left: calc(var(--tooltip-arrow-size) * -1);
    }
}
.#{$prefix}-trigger:hover .#{$prefix}--right,
.#{$prefix}-trigger:focus-visible .#{$prefix}--right {
    transform: translateY(-50%) scale(1);
}

// Left
.#{$prefix}--left {
    top: 50%;
    right: calc(100% + var(--tooltip-offset));
    transform-origin: right center;
    transform: translateY(-50%) scale(0.95);

    .#{$prefix}__arrow {
        top: calc(50% - var(--tooltip-arrow-size));
        right: calc(var(--tooltip-arrow-size) * -1);
    }
}
.#{$prefix}-trigger:hover .#{$prefix}--left,
.#{$prefix}-trigger:focus-visible .#{$prefix}--left {
    transform: translateY(-50%) scale(1);
}

// --- Style Variants ---

// Light Theme
.#{$prefix}--light {
    --tooltip-bg: #f9fafb; // gray-50
    --tooltip-fg: #1f2937; // gray-800
}
