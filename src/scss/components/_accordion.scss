@use "sass:map";

$prefix: "accordion" !default;

// A map to hold all default CSS variables for easy setup and theming.
$config: (
    // Sizing & Spacing
    "padding": 1.25rem,
    "gap": 0.5rem,
    // Space between items
    "radius": 0.75rem,

    // Theming
    "bg": #ffffff,
    "header-bg": #f9fafb,
    // gray-50
    "fg": #1f2937,
    // gray-800
    "secondary-fg": #6b7280,
    // gray-500
    "border-color": #e5e7eb,
    // gray-200
    "shadow": 0 1px 2px 0 rgba(0, 0, 0, 0.05),
    // State Colors
    "primary-color": #4f46e5,
    // indigo-600
    "hover-bg": #f3f4f6,
    // gray-100
    "open-fg": #4f46e5,

    // indigo-600
    // Dark Theme
    "dark-bg": #1f2937,
    // gray-800
    "dark-header-bg": #374151,
    // gray-700
    "dark-fg": #f9fafb,
    // gray-50
    "dark-secondary-fg": #9ca3af,
    // gray-400
    "dark-border-color": #4b5563,
    // gray-600
    "dark-hover-bg": #4b5563,

    // gray-600
    // Animation
    "transition-duration": "0.2s",
    "transition-timing": "ease-in-out"
) !default;

// The root container for the accordion group
.#{$prefix} {
    // Generate CSS custom properties from the $config map
    @each $key, $value in $config {
        --accordion-#{$key}: #{$value};
    }

    display: flex;
    flex-direction: column;
    gap: var(--accordion-gap);
}

// A single accordion item
.#{$prefix}__item {
    background-color: var(--accordion-bg);
    border: 1px solid var(--accordion-border-color);
    border-radius: var(--accordion-radius);
    box-shadow: var(--accordion-shadow);
    overflow: hidden; // Important for child border-radius
    transition: border-color var(--accordion-transition-duration);

    // Give the open item a primary-colored ring/border
    &.is-open {
        border-color: var(--accordion-primary-color);
    }
}

// The header, which acts as the trigger button
.#{$prefix}__header {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: var(--accordion-padding);
    background-color: var(--accordion-header-bg);
    border: none;
    font-size: 1rem;
    font-weight: 500;
    text-align: left;
    color: var(--accordion-fg);
    cursor: pointer;
    transition: background-color var(--accordion-transition-duration);

    &:hover {
        background-color: var(--accordion-hover-bg);
    }
}

// When the item is open, the header text becomes primary color
.#{$prefix}__item.is-open > .#{$prefix}__header {
    color: var(--accordion-open-fg);
}

// The chevron icon
.#{$prefix}__icon {
    flex-shrink: 0;
    width: 1.25rem;
    height: 1.25rem;
    color: var(--accordion-secondary-fg);
    transition: transform var(--accordion-transition-duration)
        var(--accordion-transition-timing);
}

.#{$prefix}__item.is-open .#{$prefix}__icon {
    transform: rotate(180deg);
}

// The collapsible panel for the content
.#{$prefix}__panel {
    display: grid;
    // Modern animation technique: animates grid rows from 0fr to 1fr
    grid-template-rows: 0fr;
    transition: grid-template-rows var(--accordion-transition-duration)
        var(--accordion-transition-timing);
}

.#{$prefix}__item.is-open > .#{$prefix}__panel {
    grid-template-rows: 1fr;
}

// The content wrapper inside the panel, for padding and overflow
.#{$prefix}__content {
    padding-inline: var(--accordion-padding);
    color: var(--accordion-secondary-fg);
    line-height: 1.6;
    overflow: hidden;
    // The content itself is not part of the animation, only its container
}

// Flush Variant (removes all spacing and borders)
.#{$prefix}--flush {
    gap: 0;

    .#{$prefix}__item {
        border-radius: 0;
        box-shadow: none;
        border-left: none;
        border-right: none;
        border-top: none;

        &:first-child {
            border-top: 1px solid var(--accordion-border-color);
        }
    }
}

// Contained Variant (adds a colored background behind the group)
.#{$prefix}--contained {
    padding: var(--accordion-gap);
    background-color: var(--accordion-header-bg);
    border-radius: var(--accordion-radius);

    .#{$prefix}__item {
        border: none; // Contained items don't need their own border
    }
}

// Dark Mode Variant
.#{$prefix}--dark {
    --accordion-bg: var(--accordion-dark-bg);
    --accordion-header-bg: var(--accordion-dark-header-bg);
    --accordion-fg: var(--accordion-dark-fg);
    --accordion-secondary-fg: var(--accordion-dark-secondary-fg);
    --accordion-border-color: var(--accordion-dark-border-color);
    --accordion-hover-bg: var(--accordion-dark-hover-bg);

    &.#{$prefix}--contained {
        background-color: #0f172a; // A slightly darker bg for dark contained
    }
}

//==========================================================================
// 3. ADDITIONAL 20 VARIANTS
//==========================================================================

// --- Stylistic Variants (Color, Borders, Effects) ---

// 1. Separated Variant (removes card look, uses lines between items)
.#{$prefix}--separated {
    gap: 0;

    .#{$prefix}__item {
        background-color: transparent;
        border-radius: 0;
        box-shadow: none;
        border: none;
        border-bottom: 1px solid var(--accordion-border-color);

        &:first-child {
            border-top: 1px solid var(--accordion-border-color);
        }
    }
}

// 2. Lifted Variant (stronger shadow for a "floating" effect)
.#{$prefix}--lifted {
    --accordion-shadow:
        0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);

    .#{$prefix}__item {
        border: none; // Shadow is enough
    }
}

// 3. Striped Variant (alternating header background colors)
.#{$prefix}--striped {
    .#{$prefix}__item:nth-of-type(even) .#{$prefix}__header {
        background-color: var(--accordion-bg);
    }
}

// 4. Filled Header Variant (header background changes color when open)
.#{$prefix}--filled-header {
    .#{$prefix}__item.is-open > .#{$prefix}__header {
        background-color: var(--accordion-primary-color);
        color: var(--accordion-dark-fg); // Assumes primary color is dark
    }
}

// 5. Content Highlight Variant (content area gets a background when open)
.#{$prefix}--content-highlight {
    .#{$prefix}__panel {
        background-color: var(--accordion-bg);
    }
    .#{$prefix}__item.is-open > .#{$prefix}__panel {
        background-color: var(--accordion-header-bg);
    }
}

// 6. Dashed Border Variant
.#{$prefix}--dashed {
    .#{$prefix}__item {
        border-style: dashed;
    }
}

// State Color Variants (Success, Warning, Error, Info)
@each $state,
    $color
        in (
            "success": #22c55e,
            // green-500
            "warning": #f97316,
            // orange-500
            "error": #ef4444,
            // red-500
            "info": #3b82f6 // blue-500
        )
{
    // 7, 8, 9, 10. State Variants
    .#{$prefix}--#{$state} {
        --accordion-primary-color: #{$color};
        --accordion-open-fg: #{$color};
    }
}

// 11. Gradient Header Variant
.#{$prefix}--gradient {
    .#{$prefix}__item.is-open > .#{$prefix}__header {
        background-image: linear-gradient(
            to right,
            var(--accordion-primary-color),
            #818cf8
        );
        color: var(--accordion-dark-fg);
    }
}

// --- Structural & Layout Variants ---

// 12. Icon Left Variant
.#{$prefix}--icon-left {
    .#{$prefix}__header {
        flex-direction: row-reverse;
    }
}

// 13. Compact Variant
.#{$prefix}--compact {
    --accordion-padding: 0.75rem 1rem;
    --accordion-gap: 0.25rem;
}

// 14. Spacious Variant
.#{$prefix}--spacious {
    --accordion-padding: 1.75rem;
    --accordion-gap: 1rem;
}

// 15. Rounded Variant (fully rounded corners)
.#{$prefix}--rounded {
    --accordion-radius: 9999px;
}

// --- Sizing Variants ---

// 16. Small Variant (for smaller text and tighter UI)
.#{$prefix}--sm {
    .#{$prefix}__header {
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
    }
    .#{$prefix}__panel {
        font-size: 0.875rem;
    }
    .#{$prefix}__content {
        padding-inline: 1rem;
    }
}

// 17. Large Variant (for emphasis and larger displays)
.#{$prefix}--lg {
    .#{$prefix}__header {
        padding: 1.5rem 1.75rem;
        font-size: 1.25rem;
    }
    .#{$prefix}__panel {
        font-size: 1.125rem;
    }
    .#{$prefix}__content {
        padding-inline: 1.75rem;
    }
}

// --- Behavioral & Animation Variants ---

// 18. Slow Animation
.#{$prefix}--slow-animation {
    --accordion-transition-duration: 0.5s;
}

// 19. Fast Animation
.#{$prefix}--fast-animation {
    --accordion-transition-duration: 0.1s;
}

// 20. No Animation (for performance or preference)
.#{$prefix}--no-animation {
    .#{$prefix}__icon,
    .#{$prefix}__panel {
        transition: none;
    }
}
