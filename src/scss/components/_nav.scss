@use "sass:map";

$prefix: "nav" !default;

// A single map to control all color variants. Add any color here and the
// SCSS will automatically generate the corresponding modifier class.
$colors: (
    "primary": #3b82f6,
    // Blue
    "slate": #64748b,
    "indigo": #6366f1,
    "purple": #8b5cf6,
    "pink": #ec4899,
    "red": #ef4444,
    "orange": #f97316,
    "yellow": #eab308,
    "green": #22c55e,
    "dark": #111827,
) !default;

.#{$prefix} {
    // CSS variables for complete control over appearance
    --nav-link-padding-y: 0.5rem;
    --nav-link-padding-x: 1rem;
    --nav-font-size: 1rem;
    --nav-radius: 0.375rem;
    --nav-gap: 0.25rem;

    // Colors that can be overridden by variants
    --nav-link-fg: #374151; // Default text color
    --nav-link-hover-fg: #000000;
    --nav-link-active-fg: #000000;
    --nav-link-disabled-fg: #d1d5db;
    --nav-pill-bg: transparent; // No background for base pills
    --nav-pill-hover-bg: #f3f4f6; // Light gray
    --nav-pill-active-bg: #e5e7eb; // Darker gray
    --nav-pill-active-fg: var(--nav-link-active-fg);
    --nav-tabs-border: #d1d5db;
    --nav-tabs-active-border: var(--nav-link-active-fg);

    display: flex;
    flex-wrap: wrap;
    padding-left: 0;
    margin-bottom: 0;
    list-style: none;
    gap: var(--nav-gap);

    &__item {
        position: relative; // Crucial for dropdown positioning
    }

    &__link {
        display: block;
        padding: var(--nav-link-padding-y) var(--nav-link-padding-x);
        font-size: var(--nav-font-size);
        color: var(--nav-link-fg);
        text-decoration: none;
        border-radius: var(--nav-radius);
        transition:
            color 0.15s ease-in-out,
            background-color 0.15s ease-in-out,
            border-color 0.15s ease-in-out;

        &:hover {
            color: var(--nav-link-hover-fg);
        }

        // Modern focus state for accessibility
        &:focus-visible {
            outline: 2px solid var(--nav-link-hover-fg);
            outline-offset: 2px;
        }

        // Active state for SPA routing, tabs, etc.
        &.is-active {
            color: var(--nav-link-active-fg);
            font-weight: 600;
        }

        // Disabled state
        &.is-disabled {
            color: var(--nav-link-disabled-fg);
            pointer-events: none;
            cursor: default;
        }
    }

    // Integrated Dropdown
    &__dropdown-content {
        display: block; // Use opacity/visibility for animation
        position: absolute;
        z-index: 10;
        top: 100%;
        left: 0;
        min-width: 180px;
        margin-top: 0.25rem;
        padding: 0.5rem;
        background-color: #fff;
        border-radius: var(--nav-radius);
        box-shadow:
            0 10px 15px -3px rgba(0, 0, 0, 0.1),
            0 4px 6px -2px rgba(0, 0, 0, 0.05);

        // Hidden by default
        opacity: 0;
        visibility: hidden;
        transform: translateY(-0.5rem);
        transition:
            opacity 0.15s ease,
            transform 0.15s ease,
            visibility 0s 0.15s linear;
    }

    // Show dropdown on hover/focus within the item
    &__item:hover > &__dropdown-content,
    &__item:focus-within > &__dropdown-content {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        transition-delay: 0s;
    }
}

.#{$prefix}--pills .#{$prefix}__link {
    background-color: var(--nav-pill-bg);
    &:hover {
        background-color: var(--nav-pill-hover-bg);
    }
    &.is-active {
        background-color: var(--nav-pill-active-bg);
        color: var(--nav-pill-active-fg);
    }
}

.#{$prefix}--tabs {
    border-bottom: 1px solid var(--nav-tabs-border);
    gap: 0;
    .#{$prefix}__link {
        margin-bottom: -1px; // Sits on top of the container border
        border: 1px solid transparent;
        border-bottom: 2px solid transparent;
        border-radius: 0;

        &:hover {
            border-color: transparent transparent var(--nav-tabs-border);
        }

        &.is-active {
            border-color: transparent transparent var(--nav-tabs-active-border);
        }
    }
}

// 1. Vertical Layout
.#{$prefix}--vertical {
    flex-direction: column;
    align-items: stretch; // Links fill the width
}
// 2. Justified (Items spread to fill the full width)
.#{$prefix}--justified .#{$prefix}__item {
    flex-basis: 0;
    flex-grow: 1;
    text-align: center;
}
// 3. Fill (Items take up equal width)
.#{$prefix}--fill .#{$prefix}__item {
    flex: 1 1 auto;
    text-align: center;
}
// 4. Align to End
.#{$prefix}--end {
    justify-content: flex-end;
}
// 5. Align to Center
.#{$prefix}--center {
    justify-content: center;
}

// This loop creates all color variants for you!
@each $name, $color in $colors {
    .#{$prefix}--color-#{$name} {
        // These variables apply to all nav styles (base, pills, tabs)
        --nav-link-hover-fg: #{$color};
        --nav-link-active-fg: #{$color};
        --nav-tabs-active-border: #{$color};
        // These are specific to pills
        --nav-pill-active-bg: #{$color};
        --nav-pill-active-fg: #fff;
        --nav-pill-hover-bg: #{rgba($color, 0.1)};
    }
}
