@use "sass:map";
// No longer need sass:color because we're handling transparency in the browser
// @use "sass:color";

$prefix: "file-input" !default;

$fi-sizes: (
    "sm": (
        "font-size": 0.8rem,
        "padding": 1.5rem,
        "icon-size": 40px,
    ),
    "md": (
        "font-size": 1rem,
        "padding": 2rem,
        "icon-size": 50px,
    ),
    "lg": (
        "font-size": 1.1rem,
        "padding": 3rem,
        "icon-size": 60px,
    ),
) !default;

.#{$prefix} {
    // CSS variables for complete control and theming.
    // FIX 1: Defined primary color as RGB components for use in rgba()
    --fi-primary-rgb: 0, 112, 243;
    --fi-primary: rgb(var(--fi-primary-rgb));

    --fi-bg: var(--white, #ffffff);
    --fi-bg-hover: var(--gray-50, #f9fafb);
    --fi-border: var(--gray-300, #d1d5db);
    --fi-border-focus: var(--fi-primary);
    --fi-text: var(--gray-700, #374151);
    --fi-text-light: var(--gray-500, #6b7280);
    --fi-icon-color: var(--gray-400, #9ca3af);
    --fi-radius: 0.75rem;
    --fi-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    --fi-transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

    // FIX 2: Corrected nested map access syntax
    --fi-font-size: #{map.get(map.get($fi-sizes, "md"), "font-size")};
    --fi-padding: #{map.get(map.get($fi-sizes, "md"), "padding")};
    --fi-icon-size: #{map.get(map.get($fi-sizes, "md"), "icon-size")};

    position: relative;
    font-family: inherit;
    font-size: var(--fi-font-size);
    width: 100%;

    // BEM: The hidden, real input
    &__native {
        opacity: 0;
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
        // Make sure it's on top of the label
        z-index: 10;
    }

    // BEM: The visible dropzone area
    &__label {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 220px;
        padding: var(--fi-padding);
        border: 2px dashed var(--fi-border);
        border-radius: var(--fi-radius);
        background-color: var(--fi-bg);
        color: var(--fi-text);
        text-align: center;
        transition: var(--fi-transition);
    }

    &__icon {
        width: var(--fi-icon-size);
        height: var(--fi-icon-size);
        color: var(--fi-icon-color);
        margin-bottom: 1rem;
        transition: var(--fi-transition);
    }
    &__prompt-main {
        font-weight: 600;
        color: var(--fi-text);
    }
    &__prompt-secondary {
        font-size: 0.875em;
        color: var(--fi-text-light);
        margin-top: 0.25rem;
    }

    // BEM: NEW Preview area for selected files
    &__preview {
        display: none; // Hidden by default
        padding: 1rem;
        border: 1px solid var(--fi-border);
        border-radius: var(--fi-radius);
    }
    &__preview-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    &__preview-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.9em;
    }
    &__preview-name {
        flex-grow: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    &__preview-remove {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        padding: 0.25rem;
        cursor: pointer;
        color: var(--fi-text-light);
        border-radius: 99px;

        &:hover {
            color: var(--fi-text);
            background-color: var(--fi-bg-hover);
        }
    }
}

.#{$prefix}:hover .#{$prefix}__label {
    background-color: var(--fi-bg-hover);
    border-color: var(--gray-400, #9ca3af);
}
.#{$prefix}:focus-within {
    .#{$prefix}__label,
    .#{$prefix}__preview {
        border-color: var(--fi-border-focus);
        // FIX 3: Replaced Sass color.adjust() with browser-native rgba()
        box-shadow: 0 0 0 3px rgba(var(--fi-primary-rgb), 0.25);
    }
}
.#{$prefix}.is-dragging .#{$prefix}__label {
    // FIX 3: Replaced Sass color.adjust() with browser-native rgba()
    background-color: rgba(var(--fi-primary-rgb), 0.05);
    border-color: var(--fi-primary);
    border-style: solid;

    .#{$prefix}__icon {
        transform: scale(1.1);
        color: var(--fi-primary);
    }
}

// KEY IMPROVEMENT: When a file is selected...
.#{$prefix}.has-file {
    .#{$prefix}__label,
    .#{$prefix}__button-label {
        display: none;
    } // Hide the dropzone
    .#{$prefix}__preview {
        display: block;
    } // Show the preview
}
.#{$prefix}.is-invalid {
    --fi-border: var(--red-500, #ef4444);
    --fi-text-light: var(--red-600, #dc2626);
    --fi-icon-color: var(--red-500, #ef4444);
}

@each $name, $props in $fi-sizes {
    .#{$prefix}--#{$name} {
        --fi-font-size: #{map.get($props, "font-size")};
        --fi-padding: #{map.get($props, "padding")};
        --fi-icon-size: #{map.get($props, "icon-size")};
    }
}

// NEW: Button Variant
.#{$prefix}--button {
    .#{$prefix}__label {
        display: none;
    } // Always hide the dropzone
    .#{$prefix}__button-label {
        // This class would be applied to a <span> inside the <label> tag
        display: inline-block;
        padding: 0.75em 1.5em;
        border: 1px solid var(--fi-border);
        border-radius: var(--fi-radius);
        background-color: var(--fi-bg);
        cursor: pointer;
        transition: var(--fi-transition);

        &:hover {
            background-color: var(--fi-bg-hover);
        }
    }
}

// NEW: Dark Theme
.#{$prefix}--dark {
    --fi-bg: #1f2937;
    --fi-bg-hover: #374151;
    --fi-border: #4b5563;
    --fi-text: #d1d5db;
    --fi-text-light: #9ca3af;
    --fi-icon-color: #6b7280;
}
