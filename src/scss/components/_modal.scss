@use "sass:map";

$prefix: "modal" !default;

$config: (
    // Sizing
    "width": 640px,
    "max-width": calc(100vw - 2rem),
    "padding": 1.5rem,
    "radius": 0.75rem,
    // Colors (Light Theme)
    "bg": #ffffff,
    "fg": #111827,
    "header-bg": #f9fafb,
    "footer-bg": #f9fafb,
    "overlay-bg": rgba(17, 24, 39, 0.65),
    "border": #e5e7eb,
    "close-fg": #6b7280,
    "primary-bg": #3b82f6,
    "primary-fg": #ffffff,
    // Theming (Dark Theme)
    "dark-bg": #1f2937,
    "dark-fg": #f9fafb,
    "dark-header-bg": #111827,
    "dark-footer-bg": #111827,
    "dark-border": #374151,
    "dark-close-fg": #9ca3af,
    // Animation
    "transition-duration": 0.25s,
    "transition-timing": cubic-bezier(0.4, 0, 0.2, 1),
    // Stacking
    "z-index": 1000,
    // Shadow
    "shadow":
        "0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)"
) !default;

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}
@keyframes scaleUp {
    from {
        transform: scale(0.95);
    }
    to {
        transform: scale(1);
    }
}
@keyframes slideDown {
    from {
        transform: translateY(-30px);
    }
    to {
        transform: translateY(0);
    }
}
@keyframes slideUp {
    from {
        transform: translateY(30px);
    }
    to {
        transform: translateY(0);
    }
}

.#{$prefix} {
    @each $key, $value in $config {
        --modal-#{$key}: #{$value};
    }

    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    z-index: var(--modal-z-index);
    opacity: 0;
    visibility: hidden;
    transition:
        opacity var(--modal-transition-duration) var(--modal-transition-timing),
        visibility 0s var(--modal-transition-duration) linear;

    &__overlay {
        position: absolute;
        inset: 0;
        background-color: var(--modal-overlay-bg);
        animation: fadeIn var(--modal-transition-duration)
            var(--modal-transition-timing);
    }

    &__dialog {
        position: relative;
        display: flex;
        flex-direction: column;
        width: var(--modal-width);
        max-width: var(--modal-max-width);
        max-height: calc(100vh - 2rem);
        background-color: var(--modal-bg);
        border-radius: var(--modal-radius);
        box-shadow: var(--modal-shadow);
        color: var(--modal-fg);
        text-align: left;
        animation: scaleUp var(--modal-transition-duration)
            var(--modal-transition-timing);
    }

    &__header,
    &__footer {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        padding: 1rem var(--modal-padding);
    }
    &__header {
        justify-content: space-between;
        border-bottom: 1px solid var(--modal-border);
        background-color: var(--modal-header-bg);
    }
    &__footer {
        justify-content: flex-end;
        gap: 0.75rem;
        border-top: 1px solid var(--modal-border);
        background-color: var(--modal-footer-bg);
    }
    &__title {
        font-size: 1.125rem;
        font-weight: 600;
        margin: 0;
    }
    &__body {
        flex-grow: 1;
        padding: var(--modal-padding);
        overflow-y: auto;
    }
    &__close {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        z-index: 10;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2.5rem;
        height: 2.5rem;
        border: none;
        background: none;
        cursor: pointer;
        color: var(--modal-close-fg);
        border-radius: 99px;
        &:hover {
            background-color: var(--modal-header-bg);
        }
    }
}

.#{$prefix}.is-open {
    opacity: 1;
    visibility: visible;
    transition-delay: 0s;
}

// --- Sizing Variants (5) ---
// 1. Small
.#{$prefix}--size-sm {
    --modal-width: 420px;
}
// 2. Large
.#{$prefix}--size-lg {
    --modal-width: 960px;
}
// 3. Extra Large
.#{$prefix}--size-xl {
    --modal-width: 1280px;
}
// 4. Fullscreen
.#{$prefix}--fullscreen .#{$prefix}__dialog {
    width: 100%;
    max-width: 100%;
    height: 100%;
    max-height: 100%;
    border-radius: 0;
}
// 5. Content Width
.#{$prefix}--content-width {
    .#{$prefix}__dialog {
        width: auto;
        max-width: var(--modal-max-width);
    }
}

// --- Positioning Variants (5) ---
// 6. Position Top
.#{$prefix}--position-top {
    align-items: flex-start;
}
// 7. Position Bottom
.#{$prefix}--position-bottom {
    align-items: flex-end;
}
// 8. Drawer Right
.#{$prefix}--drawer-right {
    justify-content: flex-end;
    padding: 0;
    .#{$prefix}__dialog {
        height: 100%;
        max-height: 100%;
        width: 480px;
        border-radius: 0;
        animation-name: slideInRight; // Requires keyframes
    }
}
// 9. Drawer Left
.#{$prefix}--drawer-left {
    justify-content: flex-start;
    padding: 0;
    .#{$prefix}__dialog {
        height: 100%;
        max-height: 100%;
        width: 480px;
        border-radius: 0;
        animation-name: slideInLeft; // Requires keyframes
    }
}
// 10. Notification (Bottom Right)
.#{$prefix}--notification {
    align-items: flex-end;
    justify-content: flex-end;
    pointer-events: none; // Click through the container
    .#{$prefix}__dialog {
        pointer-events: auto;
        animation-name: slideUp;
    }
}
@keyframes slideInRight {
    from {
        transform: translateX(100%);
    }
    to {
        transform: translateX(0);
    }
}
@keyframes slideInLeft {
    from {
        transform: translateX(-100%);
    }
    to {
        transform: translateX(0);
    }
}

// --- Styling & Theming Variants (8) ---
// 11. Dark Theme
.#{$prefix}--dark {
    --modal-bg: var(--modal-dark-bg);
    --modal-fg: var(--modal-dark-fg);
    --modal-header-bg: var(--modal-dark-header-bg);
    --modal-footer-bg: var(--modal-dark-footer-bg);
    --modal-border: var(--modal-dark-border);
    --modal-close-fg: var(--modal-dark-close-fg);
}
// 12. More Rounded
.#{$prefix}--rounded-lg {
    --modal-radius: 1.5rem;
}
// 13. Fully Rounded (Pill)
.#{$prefix}--rounded-full {
    --modal-radius: 9999px;
}
// 14. Borderless
.#{$prefix}--borderless {
    .#{$prefix}__header,
    .#{$prefix}__footer {
        border: none;
    }
}
// 15. Primary Accent
.#{$prefix}--accent-primary {
    .#{$prefix}__header {
        background-color: var(--modal-primary-bg);
        color: var(--modal-primary-fg);
        --modal-close-fg: var(--modal-primary-fg);
    }
}
// 16. Lighter Shadow
.#{$prefix}--shadow-sm {
    --modal-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
}
// 17. No Shadow
.#{$prefix}--shadow-none {
    --modal-shadow: none;
}
// 18. Blur Backdrop
.#{$prefix}--blur-backdrop .#{$prefix}__overlay {
    backdrop-filter: blur(4px);
    --modal-overlay-bg: rgba(255, 255, 255, 0.1); // Works better with blur
}

// --- Animation & Behavior Variants (4) ---
// 19. No Animation
.#{$prefix}--no-animation .#{$prefix}__dialog,
.#{$prefix}--no-animation .#{$prefix}__overlay {
    animation: none;
}
// 20. Slide from Top
.#{$prefix}--slide-from-top .#{$prefix}__dialog {
    animation-name: slideDown;
}
// 21. Slide from Bottom
.#{$prefix}--slide-from-bottom .#{$prefix}__dialog {
    animation-name: slideUp;
}
// 22. Persistent (No Overlay Close)
.#{$prefix}--persistent .#{$prefix}__overlay {
    cursor: default;
}

// --- Content & Layout Variants (3) ---
// 23. No Padding
.#{$prefix}--no-padding .#{$prefix}__body {
    padding: 0;
}
// 24. Centered Content
.#{$prefix}--centered-content .#{$prefix}__body {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}
// 25. Form Modal
.#{$prefix}--form-modal .#{$prefix}__body {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
