@use "sass:map";

$prefix: "btn" !default;

$config: (
    // --- Core Sizing & Layout ---
    "font-size": 1rem,
    "font-weight": 500,
    "line-height": 1.5,
    "radius": 0.5rem,
    "padding-y": 0.5rem,
    "padding-x": 1rem,
    "icon-size": 1.25rem,

    // --- Sizing Variants ---
    "sm-font-size": 0.875rem,
    "sm-padding-y": 0.25rem,
    "sm-padding-x": 0.75rem,
    "lg-font-size": 1.125rem,
    "lg-padding-y": 0.75rem,
    "lg-padding-x": 1.5rem,

    // --- Animation ---
    "transition":
        "color 0.15s ease, background-color 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease",

    "primary-bg": hsl(222.2, 47.4%, 11.2%),
    "primary-fg": hsl(210, 40%, 98%),
    "primary-hover-bg": hsl(222.2, 47.4%, 21.2%),
    "secondary-bg": hsl(210, 40%, 96.1%),
    "secondary-fg": hsl(222.2, 47.4%, 11.2%),
    "secondary-hover-bg": hsl(210, 40%, 92%),
    "destructive-bg": hsl(0, 84.2%, 60.2%),
    "destructive-fg": hsl(210, 40%, 98%),
    "destructive-hover-bg": hsl(0, 84.2%, 70.2%),
    "success-bg": hsl(142.1, 76.2%, 41.2%),
    "success-fg": hsl(210, 40%, 98%),
    "success-hover-bg": hsl(142.1, 76.2%, 51.2%),
    "warning-bg": hsl(48, 95%, 50%),
    "warning-fg": hsl(48, 95%, 10%),
    "warning-hover-bg": hsl(48, 95%, 60%),
    "ghost-fg": hsl(222.2, 47.4%, 11.2%),
    "ghost-hover-bg": hsl(210, 40%, 96.1%),
    "link-fg": hsl(222.2, 47.4%, 11.2%),
    "link-hover-fg": hsl(222.2, 47.4%, 31.2%),
    "base-border": hsl(214.3, 31.8%, 91.4%),
    "focus-ring": hsl(215, 20.2%, 65.1%),
    "dark-primary-bg": hsl(210, 40%, 98%),
    "dark-primary-fg": hsl(222.2, 47.4%, 11.2%),
    "dark-primary-hover-bg": hsl(210, 40%, 92%),
    "dark-secondary-bg": hsl(215, 28%, 17%),
    "dark-secondary-fg": hsl(210, 40%, 98%),
    "dark-secondary-hover-bg": hsl(215, 28%, 27%),
    "dark-destructive-bg": hsl(0, 63%, 31%),
    "dark-destructive-fg": hsl(210, 40%, 98%),
    "dark-destructive-hover-bg": hsl(0, 63%, 41%),
    "dark-success-bg": hsl(142.1, 76.2%, 21.2%),
    "dark-success-fg": hsl(210, 40%, 98%),
    "dark-success-hover-bg": hsl(142.1, 76.2%, 31.2%),
    "dark-warning-bg": hsl(48, 95%, 20%),
    "dark-warning-fg": hsl(48, 95%, 90%),
    "dark-warning-hover-bg": hsl(48, 95%, 30%),
    "dark-ghost-fg": hsl(210, 40%, 98%),
    "dark-ghost-hover-bg": hsl(215, 28%, 17%),
    "dark-link-fg": hsl(210, 40%, 98%),
    "dark-link-hover-fg": hsl(210, 40%, 88%),
    "dark-base-border": hsl(215, 28%, 22%),
    "dark-focus-ring": hsl(215, 32%, 75%)
) !default;

.#{$prefix} {
    // --- Generate CSS custom properties from the $config map ---
    @each $key, $value in $config {
        --btn-#{$key}: #{$value};
    }

    // --- Base Styles ---
    display: inline-flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    vertical-align: middle;
    user-select: none;
    cursor: pointer;

    // --- Core Appearance (uses variables defined above) ---
    font-size: var(--btn-font-size);
    font-weight: var(--btn-font-weight);
    line-height: var(--btn-line-height);
    padding: var(--btn-padding-y) var(--btn-padding-x);
    border-radius: var(--btn-radius);
    transition: var(--btn-transition);

    // --- Default to secondary variant styles ---
    color: var(--btn-fg, var(--btn-secondary-fg));
    background-color: var(--btn-bg, var(--btn-secondary-bg));
    border: 1px solid var(--btn-border, var(--btn-base-border));

    // --- States ---
    &:hover {
        color: var(--btn-hover-fg, var(--btn-fg, var(--btn-secondary-fg)));
        background-color: var(--btn-hover-bg, var(--btn-secondary-hover-bg));
        border-color: var(
            --btn-hover-border,
            var(--btn-hover-bg, var(--btn-base-border))
        );
    }

    &:focus-visible {
        outline: 2px solid var(--btn-focus-ring);
        outline-offset: 2px;
    }

    &[disabled],
    &:disabled {
        pointer-events: none;
        opacity: 0.5;
    }
}

// --- 1. Primary ---
.#{$prefix}--primary {
    --btn-fg: var(--btn-primary-fg);
    --btn-bg: var(--btn-primary-bg);
    --btn-border: var(--btn-primary-bg);
    --btn-hover-bg: var(--btn-primary-hover-bg);
    --btn-hover-border: var(--btn-primary-hover-bg);
}

// --- 2. Secondary (default, but class is provided for clarity) ---
.#{$prefix}--secondary {
    --btn-fg: var(--btn-secondary-fg);
    --btn-bg: var(--btn-secondary-bg);
    --btn-border: var(--btn-base-border);
    --btn-hover-bg: var(--btn-secondary-hover-bg);
    --btn-hover-border: var(--btn-base-border);
}

// --- 3. Destructive ---
.#{$prefix}--destructive {
    --btn-fg: var(--btn-destructive-fg);
    --btn-bg: var(--btn-destructive-bg);
    --btn-border: var(--btn-destructive-bg);
    --btn-hover-bg: var(--btn-destructive-hover-bg);
    --btn-hover-border: var(--btn-destructive-hover-bg);
}

// --- 4. Success ---
.#{$prefix}--success {
    --btn-fg: var(--btn-success-fg);
    --btn-bg: var(--btn-success-bg);
    --btn-border: var(--btn-success-bg);
    --btn-hover-bg: var(--btn-success-hover-bg);
    --btn-hover-border: var(--btn-success-hover-bg);
}

// --- 5. Warning ---
.#{$prefix}--warning {
    --btn-fg: var(--btn-warning-fg);
    --btn-bg: var(--btn-warning-bg);
    --btn-border: var(--btn-warning-bg);
    --btn-hover-bg: var(--btn-warning-hover-bg);
    --btn-hover-border: var(--btn-warning-hover-bg);
}

// --- 6. Outline Primary ---
.#{$prefix}--outline-primary {
    --btn-fg: var(--btn-primary-bg);
    --btn-bg: transparent;
    --btn-border: var(--btn-primary-bg);
    --btn-hover-fg: var(--btn-primary-fg);
    --btn-hover-bg: var(--btn-primary-bg);
}

// --- 7. Outline Secondary ---
.#{$prefix}--outline-secondary {
    --btn-fg: var(--btn-secondary-fg);
    --btn-bg: transparent;
    --btn-border: var(--btn-base-border);
    --btn-hover-bg: var(--btn-secondary-bg);
}

// --- 8. Outline Destructive ---
.#{$prefix}--outline-destructive {
    --btn-fg: var(--btn-destructive-bg);
    --btn-bg: transparent;
    --btn-border: var(--btn-destructive-bg);
    --btn-hover-fg: var(--btn-destructive-fg);
    --btn-hover-bg: var(--btn-destructive-bg);
}

// --- 9. Outline Success ---
.#{$prefix}--outline-success {
    --btn-fg: var(--btn-success-bg);
    --btn-bg: transparent;
    --btn-border: var(--btn-success-bg);
    --btn-hover-fg: var(--btn-success-fg);
    --btn-hover-bg: var(--btn-success-bg);
}

// --- 10. Outline Warning ---
.#{$prefix}--outline-warning {
    --btn-fg: var(--btn-warning-bg);
    --btn-bg: transparent;
    --btn-border: var(--btn-warning-bg);
    --btn-hover-bg: var(--btn-warning-bg);
}

// --- 11. Subtle Primary ---
.#{$prefix}--subtle-primary {
    --btn-fg: var(--btn-primary-bg);
    --btn-bg: hsl(222, 100%, 97%);
    --btn-border: transparent;
    --btn-hover-bg: hsl(222, 100%, 94%);
}

// --- 12. Subtle Secondary ---
.#{$prefix}--subtle-secondary {
    --btn-fg: var(--btn-secondary-fg);
    --btn-bg: var(--btn-secondary-bg);
    --btn-border: transparent;
    --btn-hover-bg: var(--btn-secondary-hover-bg);
}

// --- 13. Subtle Destructive ---
.#{$prefix}--subtle-destructive {
    --btn-fg: var(--btn-destructive-bg);
    --btn-bg: hsl(0, 100%, 97%);
    --btn-border: transparent;
    --btn-hover-bg: hsl(0, 100%, 94%);
}

// --- 14. Subtle Success ---
.#{$prefix}--subtle-success {
    --btn-fg: var(--btn-success-bg);
    --btn-bg: hsl(142, 90%, 97%);
    --btn-border: transparent;
    --btn-hover-bg: hsl(142, 90%, 94%);
}

// --- 15. Subtle Warning ---
.#{$prefix}--subtle-warning {
    --btn-fg: var(--btn-warning-bg);
    --btn-bg: hsl(48, 100%, 97%);
    --btn-border: transparent;
    --btn-hover-bg: hsl(48, 100%, 94%);
}

// --- 16. Ghost ---
.#{$prefix}--ghost {
    --btn-fg: var(--btn-ghost-fg);
    --btn-bg: transparent;
    --btn-border: transparent;
    --btn-hover-bg: var(--btn-ghost-hover-bg);
}

// --- 17. Link ---
.#{$prefix}--link {
    --btn-fg: var(--btn-link-fg);
    --btn-bg: transparent;
    --btn-border: transparent;
    --btn-hover-fg: var(--btn-link-hover-fg);
    text-decoration: underline;
    text-underline-offset: 4px;
    padding-left: 0.25rem;
    padding-right: 0.25rem;

    &:hover {
        background-color: transparent;
    }
}

// --- 18. Small ---
.#{$prefix}--sm {
    font-size: var(--btn-sm-font-size);
    padding: var(--btn-sm-padding-y) var(--btn-sm-padding-x);
}

// --- 19. Large ---
.#{$prefix}--lg {
    font-size: var(--btn-lg-font-size);
    padding: var(--btn-lg-padding-y) var(--btn-lg-padding-x);
}

// --- 20. Block ---
.#{$prefix}--block {
    width: 100%;
}

// --- 21. Pill ---
.#{$prefix}--pill {
    border-radius: 9999px;
}

// --- 22. Icon ---
.#{$prefix}--icon {
    width: calc(var(--btn-icon-size) + (var(--btn-padding-y) * 2));
    height: calc(var(--btn-icon-size) + (var(--btn-padding-y) * 2));
    padding: 0;

    &.#{$prefix}--sm {
        --btn-icon-size: 1rem;
    }
    &.#{$prefix}--lg {
        --btn-icon-size: 1.5rem;
    }
}

// --- 23. Loading ---
.#{$prefix}--loading {
    pointer-events: none;
    color: transparent !important;
    position: relative;

    &::after {
        content: "";
        position: absolute;
        width: 1rem;
        height: 1rem;
        top: calc(50% - 0.5rem);
        left: calc(50% - 0.5rem);
        border-radius: 50%;
        // Use the button's *original* foreground color for the spinner
        border: 2px solid var(--btn-fg);
        border-right-color: transparent;
        animation: btn-spin 0.75s linear infinite;
    }
}

@keyframes btn-spin {
    to {
        transform: rotate(360deg);
    }
}

// --- 24. Dark Mode Primary ---
// --- 25. Dark Mode Secondary (and all other variants) ---
.dark {
    .#{$prefix} {
        // Override the base color palette with the dark theme variables
        --btn-primary-bg: var(--btn-dark-primary-bg);
        --btn-primary-fg: var(--btn-dark-primary-fg);
        --btn-primary-hover-bg: var(--btn-dark-primary-hover-bg);

        --btn-secondary-bg: var(--btn-dark-secondary-bg);
        --btn-secondary-fg: var(--btn-dark-secondary-fg);
        --btn-secondary-hover-bg: var(--btn-dark-secondary-hover-bg);

        --btn-destructive-bg: var(--btn-dark-destructive-bg);
        --btn-destructive-fg: var(--btn-dark-destructive-fg);
        --btn-destructive-hover-bg: var(--btn-dark-destructive-hover-bg);

        --btn-success-bg: var(--btn-dark-success-bg);
        --btn-success-fg: var(--btn-dark-success-fg);
        --btn-success-hover-bg: var(--btn-dark-success-hover-bg);

        --btn-warning-bg: var(--btn-dark-warning-bg);
        --btn-warning-fg: var(--btn-dark-warning-fg);
        --btn-warning-hover-bg: var(--btn-dark-warning-hover-bg);

        --btn-ghost-fg: var(--btn-dark-ghost-fg);
        --btn-ghost-hover-bg: var(--btn-dark-ghost-hover-bg);

        --btn-link-fg: var(--btn-dark-link-fg);
        --btn-link-hover-fg: var(--btn-dark-link-hover-fg);

        --btn-base-border: var(--btn-dark-base-border);
        --btn-focus-ring: var(--btn-dark-focus-ring);

        // --- Subtle variants need special overrides for dark mode ---
        &.#{$prefix}--subtle-primary {
            --btn-fg: var(--btn-dark-primary-bg);
            --btn-bg: hsl(210, 100%, 15%);
            --btn-hover-bg: hsl(210, 100%, 20%);
        }
        &.#{$prefix}--subtle-destructive {
            --btn-fg: var(--btn-dark-destructive-fg);
            --btn-bg: hsl(0, 63%, 15%);
            --btn-hover-bg: hsl(0, 63%, 20%);
        }
        &.#{$prefix}--subtle-success {
            --btn-fg: var(--btn-dark-success-fg);
            --btn-bg: hsl(142, 76%, 10%);
            --btn-hover-bg: hsl(142, 76%, 15%);
        }
        &.#{$prefix}--subtle-warning {
            --btn-fg: var(--btn-dark-warning-fg);
            --btn-bg: hsl(48, 95%, 10%);
            --btn-hover-bg: hsl(48, 95%, 15%);
        }
    }
}
